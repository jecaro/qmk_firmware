#include QMK_KEYBOARD_H

#include <keymap_french.h>

#include "features/layer_lock.h"

enum sofle_layers {
    _AZERTY = 0,
    _NAVIGATION,
    _SYMBOLS,
    _NUMBERS,
};

enum custom_keycodes {
  LLOCK = SAFE_RANGE,
};

#define NAV(_x_) LT(_NAVIGATION, _x_)
#define SYM(_x_) LT(_SYMBOLS, _x_)
#define NUM(_x_) LT(_NUMBERS, _x_)

// layers
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/*
 * AZERTY
 * ,-----------------------------------------.                    ,-----------------------------------------.
 * | + =  |  1 & |  2 é |  3 " |  4 ' |  5 ( |                    |  6 - |  7 è |  8 _ |  9 ç |  0 à |  ° ) |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * | Tab  |   A  |   Z  |   E  |   R  |   T  |                    |   Y  |   U  |   I  |   O  |   P  |  ^ " |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * | ESC  |   Q  |   S  |   D  |   F  |   G  |-------.    ,-------|   H  |   J  |   K  |   L  |   M  |  ù % |
 * |------+------+------+------+------+------| PLAY  |    | MUTE  |------+------+------+------+------+------|
 * |LShift|   W  |   X  |   C  |   V  |   B  |-------|    |-------|   N  |  , ? |  ; . |  : / |  ! § |RShift|
 * `-----------------------------------------/       /     \      \-----------------------------------------'
 *            | LCtr | LGUI | LAlt |ESC   | /Space  /       \Enter \  |Bspc  | RAlt | RGUI | RCtr |
 *            |      |      |      |      |/       /         \      \ |      |      |      |      |
 *            `----------------------------------'           '------''---------------------------'
 */

[_AZERTY] = LAYOUT( \
  FR_EQL,  FR_AMPR, FR_EACU,  FR_DQUO, FR_QUOT,     FR_LPRN,                       FR_MINS,     FR_EGRV, FR_UNDS,  FR_CCED, FR_AGRV, FR_RPRN, \
  KC_TAB,  FR_A,    FR_Z,     FR_E,    FR_R,        FR_T,                          FR_Y,        FR_U,    FR_I,     FR_O,    FR_P,    FR_CIRC, \
  KC_ESC,  FR_Q,    FR_S,     FR_D,    FR_F,        FR_G,                          FR_H,        FR_J,    FR_K,     FR_L,    FR_M,    FR_UGRV, \
  KC_LSFT, FR_W,    FR_X,     FR_C,    FR_V,        FR_B,        KC_MPLY, KC_MUTE, FR_N,        FR_COMM, FR_SCLN,  FR_COLN, FR_EXLM, KC_RSFT, \
           KC_LCTL, KC_LGUI, KC_LALT,  NUM(KC_ESC), NAV(KC_SPC),                   SYM(KC_ENT), KC_BSPC, KC_LALT,  KC_RGUI, KC_RCTL \
),

/*
 * Navigation
 * ,-----------------------------------------.                    ,-----------------------------------------.
 * |      |  F1  |  F2  |  F3  |  F4  |  F5  |                    |  F6  |  F7  |  F8  |  F9  | F10  | F11  |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * |      |      |      |      |      |      |                    | Home |PgDown| PgUp | End  | Del  | F12  |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * |      |      |      |      |      |      |-------.    ,-------| Left | Down |  Up  | Right|      |      |
 * |------+------+------+------+------+------|       |    |       |------+------+------+------+------+------|
 * |      |      |      |      |      |      |-------|    |-------|      |      |      |      |      |      |
 * `-----------------------------------------/       /     \      \-----------------------------------------'
 *            |      |      |      |      | /       /       \      \  |      |      |      |      |
 *            |      |      |      |      |/       /         \      \ |      |      |      |      |
 *            `----------------------------------'           '------''---------------------------'
 */
[_NAVIGATION] = LAYOUT( \
  LLOCK,   KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,                     KC_F6,   KC_F7,   KC_F8,   KC_F9,    KC_F10,  KC_F11, \
  _______, _______, _______, _______, _______, _______,                   KC_HOME, KC_PGDN, KC_PGUP, KC_END,   KC_DEL,  KC_F12, \
  _______, _______, _______, _______, _______, _______,                   KC_LEFT, KC_DOWN, KC_UP,   KC_RIGHT, _______, _______, \
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,  _______, _______, \
           _______, _______, _______, _______, _______,                   _______, _______, _______, _______,  _______ \
),

/*
 * Symbols hold enter
 * ,-----------------------------------------.                    ,-----------------------------------------.
 * |      |      |  ~   |  #   |  {   |  [   |                    |  |   |  `   |  \   |      |  @   |  ]   |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * |      |      |      |  €   |      |  (   |                    |  )   |  ^   |  $   |      |      |      |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * |      |      |      |      |      |  [   |-------.    ,-------|  ]   |  *   |  #   |      |      |      |
 * |------+------+------+------+------+------|       |    |       |------+------+------+------+------+------|
 * |      |      |      |      |      |  {   |-------|    |-------|  }   |  <   |  >   |      |      |      |
 * `-----------------------------------------/       /     \      \-----------------------------------------'
 *            |      |      |      |      | /       /       \      \  |      |      |      |      |
 *            |      |      |      |      |/       /         \      \ |      |      |      |      |
 *            `----------------------------------'           '------''---------------------------'
 */
[_SYMBOLS] = LAYOUT( \
  LLOCK,   _______, FR_TILD, FR_HASH, FR_LCBR, FR_LBRC,                   FR_PIPE, FR_GRV,  FR_BSLS, _______, FR_AT,   FR_RBRC, \
  _______, _______, _______, FR_EURO, _______, FR_LPRN,                   FR_RPRN, FR_CIRC, FR_DLR,  _______, _______, _______, \
  _______, _______, _______, _______, _______, FR_LBRC,                   FR_RBRC, FR_ASTR, FR_HASH, _______, _______, _______, \
  _______, _______, _______, _______, _______, FR_LCBR, _______, _______, FR_RCBR, FR_LABK, FR_RABK, _______, _______, _______, \
           _______, _______, _______, _______, _______,                   _______, _______, _______, _______, _______ \
),

/*
 * Numbers
 * ,-----------------------------------------.                    ,-----------------------------------------.
 * |      |      |      |      |      |      |                    |      |  7   |  8   |  9   |  *   |  /   |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * |      |      |      |      |      |      |                    |      |  4   |  5   |  6   |  +   |  -   |
 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
 * |      |      |      |      |      |      |-------.    ,-------|      |  1   |  2   |  3   |  (   |  )   |
 * |------+------+------+------+------+------|       |    |       |------+------+------+------+------+------|
 * |      |      |      |      |      |      |-------|    |-------|      |  0   |  ,   |  .   |  =   |Enter |
 * `-----------------------------------------/       /     \      \-----------------------------------------'
 *            |      |      |      |      | /       /       \      \  |      |      |      |      |
 *            |      |      |      |      |/       /         \      \ |      |      |      |      |
 *            `----------------------------------'           '------''---------------------------'
 */
[_NUMBERS] = LAYOUT( \
  LLOCK,   _______, _______, _______, _______, _______,                   _______, FR_7,    FR_8,    FR_9,   FR_ASTR, FR_SLSH, \
  _______, _______, _______, _______, _______, _______,                   _______, FR_4,    FR_5,    FR_6,   FR_PLUS, FR_MINS, \
  _______, _______, _______, _______, _______, _______,                   _______, FR_1,    FR_2,    FR_3,   FR_LPRN, FR_RPRN, \
  _______, _______, _______, _______, _______, _______, _______, _______, _______, FR_0,    FR_COLN, FR_DOT, FR_EQL,  KC_ENT,  \
           _______, _______, _______, _______, _______,                   _______, _______, _______, _______, _______ \
),
};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    if (!process_layer_lock(keycode, record, LLOCK))
    {
        return false;
    }

  return true;
}

#ifdef ENCODER_ENABLE

bool encoder_update_user(uint8_t index, bool clockwise) {
    if (index == 0) {
        if (clockwise) {
            tap_code(KC_MNXT);
        } else {
            tap_code(KC_MPRV);
        }
    }
    else {
        if (clockwise) {
            tap_code(KC_VOLU);
        } else {
            tap_code(KC_VOLD);
        }
    }
    return false;
}

#endif
